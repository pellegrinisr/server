//this file will hold the main code for the word guess game.
//the user will be given a random word to guess, selected from an array
//it will be presented to the user as a series of underscores
//they will have a certain amount of guesses
//guesses will be generated by pressing a valid key on the keyboard
//guessed letters will be added to an array.  the user will be unable to guess
//the same letter again.
//the program will keep track of # of wins and # of games played.

//object to represent word game
var wordGame = {
    //properties
    numGuesses : 8,
    words : ["koreatown", "downtown", "silver lake", "echo park", "westwood", "macarthur park", "westwood", "los feliz", "venice", "marina del rey", "studio city", "century city", "mar vista", "sawtelle", "westchester", "playa del rey", "playa vista", "hollywood"],
    numWins : 0,
    numLosses : 0,
    validLetters : ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z'],
    guessedLetters : [],
    currentLetterGuessed : '',
    myWord : '',
    numKeyPresses : 0,
    myUnderscoresArray: [],
    playAgain : null,
    imgArray : [],
    currentImg : 0,

    //methods

    //generate a random number
    //use the random number to select a word by index
    //from the array of words 
    generateNewWord : function() {
        var myRand; 

        myRand = Math.floor(Math.random() * wordGame.words.length);
        wordGame.myWord = wordGame.words[myRand];
    },

    //calls the generate word method
    //displays the blank spaces from the underscore array
    //to the corresponding element on the page.
    startPlay : function() {
        //this function needs to be triggered on the first key press after page loads

        //get the new word
        this.generateNewWord();
        //display the blank spaces
        for (var i = 0; i < wordGame.myWord.length; i++) {
            if(wordGame.myWord.charAt(i) !== ' ') {
                wordGame.myUnderscoresArray[i] = '_';
            }
            else {
                wordGame.myUnderscoresArray[i] = '|';
            }
        }
        $("#currentWord").val(wordGame.myUnderscoresArray.join(' '));
        $("#guessesRemaining").val(wordGame.numGuesses);
         
        //document.getElementById("currentWord").value = wordGame.myUnderscoresArray.toString().replace(/,/g, ' ');
       // document.getElementById("guessesRemaining").value = wordGame.numGuesses;
    }, 

    //search the word to see if the guessed letter is found
    //if the letter is found, change the corresponding index in 
    //the array of underscores.
    searchWord : function() {
       // alert("search word function called"); 
        var isFound = false;
        for (var i = 0; i < wordGame.myWord.length; i++) {
            if (wordGame.currentLetterGuessed === wordGame.myWord[i]) {
                wordGame.myUnderscoresArray[i] = wordGame.currentLetterGuessed;
                isFound = true;
               // alert(isFound);
            }
        }
        //console.log(isFound);
        $("#currentWord").val(wordGame.myUnderscoresArray.join(' '));
        if (!isFound) {
            //debugger;
            wordGame.numGuesses--;
            wordGame.currentImg++;
            $(".myImage").attr("src", wordGame.imgArray[wordGame.currentImg].src);
            $("#guessesRemaining").val(this.numGuesses);
            wordGame.checkIfLost();
        }
        else {
            wordGame.checkIfWon();
        }  
        //document.getElementById("currentWord").value = wordGame.myUnderscoresArray.toString().replace(/,/g, ' ');
        
    },

    //deterine if the user won the game
    //called after each guess
    checkIfWon : function() {
        var i = 0;
        var isWinner = true;
        while (i < wordGame.myUnderscoresArray.length && isWinner === true) {
            if (wordGame.myUnderscoresArray[i] === '_') {
                isWinner = false;
            }
            else {
                i++;
            }
        }
        if (isWinner === true) {
            var audioElement = document.createElement("audio");
            audioElement.setAttribute("src", "assets/sounds/applause.wav");
            audioElement.play();
            //alert("congratulations");
            this.numKeyPresses = 0;
            this.numWins++;
            $("#numWins").val(this.numWins);
            //document.getElementById("myLabel").value = "Do you want to play again?\nPress any key to continue";
            $("#myLabel").text("Do you want to play again?\nPress any key to continue.").css("display", 'block');
        }
        
    },

    //reset the game
    //calls the startPlay method
    //resets the form boxes
    resetGame : function() {
        wordGame.myUnderscoresArray = [];
        wordGame.startPlay();
        wordGame.numGuesses = 8;
        $("#guessesRemaining").val(wordGame.numGuesses);
        //document.getElementById("guessesRemaining").value = wordGame.numGuesses;
        wordGame.guessedLetters = [];
        //document.getElementById("guessedLetters").value = wordGame.guessedLetters;   
        $("#guessedLetters").val(wordGame.guessedLetters);
        $("#numWins").val(wordGame.numWins);
        $("#numLosses").val(wordGame.numLosses);
       /* if (this.numWins > 0 || this.numLosses > 0) {
            alert('games have been played');
            $(".myImage").attr("src", wordGame.imgArray[0].src);
        }
        else {
            alert('this is the first game');
            $(".myImage").attr("src", "https://static.wixstatic.com/media/0fc0f7_3b3967ad38134a909cfa93da54e02115~mv2_d_2464_1640_s_2.jpg")
        }  */

        wordGame.currentImg = 0;
    },

    //method to check if number of guesses is less than or equal to 0
    checkIfLost : function() {
        //check if guesses left less than 0
        if (wordGame.numGuesses <= 0) {
            var audioElement = document.createElement("audio");
            audioElement.setAttribute("src", "assets/sounds/boo.wav");
            wordGame.numLosses++;
            $("#numLosses").val(wordGame.numLosses); 
            audioElement.play();
            $("#myLabel").text("Do you want to play again?\nPress any key to continue.").css("display", 'block');
            wordGame.numKeyPresses = 0;
            // wordGame.resetGame();
        }
    },

    //method to fill the object's image array with the hangman pics
    fillImageArray : function() {
        for (var i = 0; i < 9; i++) {
            wordGame.imgArray[i] = new Image();
            wordGame.imgArray[i].src = 'assets/images/img' + i + '.png';
        }
    }
};

$(document).ready(function() {
   //array of all the letters in the alphabet
   //will loop through to create buttons
    var alphabetArray = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'];
    for(var i = 0; i < alphabetArray.length; i++) {
        var button = $('<button>').addClass('letter-button');
        button.html(alphabetArray[i]);
        button.addClass(alphabetArray[i]);
        $('.button-col').append(button);
    }
    //function call to fill the array
    wordGame.fillImageArray();
    wordGame.resetGame();


    //assign a function to the onkeyup event.
    //this function will check to see if the user's keystroke is a letter
    //if it's a letter, it will check if the user has previously guessed the letter.
    //if the user has not previously guessed the letter, the keystroke is added to an array
    //of guessed letters, and the current letter is stored.
    document.onkeyup = function(ev) {
        var validChoice = false;
        var letterFound = false;

        
        var i = 0;
        var j = 0;
    
        //check if first key press after page load/reload
        if (wordGame.numKeyPresses === 0) {
            wordGame.resetGame();
            $(".myImage").attr("src", wordGame.imgArray[wordGame.currentImg].src);
            wordGame.numKeyPresses++;
            $("#myLabel").css("display", 'none');
        }
        //not the first key press since load/reload
        else {
            //loop through array of letters until choice found
            //or until it reaches the end of the array of letters.
            while (validChoice === false && i < wordGame.validLetters.length) {
                if (ev.key === wordGame.validLetters[i]) {
                    validChoice = true;
                    //if valid letter loop through array of previously guessed letters 
                    //until the letter is found or until it reaches the end of the array 
                    //of previously guessed letters
                    while (letterFound === false && j < wordGame.guessedLetters.length) {
                        if (ev.key === wordGame.guessedLetters[j]) {
                            letterFound = true;
                        }
                        else {
                            j++;
                        }
                    }
                    //key stroke was a valid alphabetic character and was not previously chosen
                    if (letterFound === false) {
                        //add the guessed letter to the array
                        wordGame.guessedLetters.push(ev.key);
                        wordGame.currentLetterGuessed = ev.key;
                        //display the updated array to the screen
                        $("#guessedLetters").val(wordGame.guessedLetters);
                        
                        //search the word to see if the user's guess is found
                        wordGame.searchWord();
                    }
                }
                else {
                    i++;
                }
            }
        } 
    }


    $(document).on('click', '.letter-button', function() {
        var i = 0;
        var j = 0;
        var validChoice = false;
        var letterFound = false;

        if (wordGame.numKeyPresses === 0) {
            wordGame.resetGame();
            $(".myImage").attr("src", wordGame.imgArray[wordGame.currentImg].src);
            wordGame.numKeyPresses++;
            $("#myLabel").css("display", 'none');
        } else {
            var buttonVal = $(this).html().toLowerCase();
            console.log(buttonVal);
            while (validChoice === false && i < wordGame.validLetters.length) {

                if(buttonVal === wordGame.validLetters[i]) {
                    validChoice = true;
                    while (letterFound === false && j < wordGame.guessedLetters.length) {
                        if(buttonVal === wordGame.guessedLetters[j]) {
                            letterFound = true;
                        } else {
                            j++;
                        }
                    }
                    if (!letterFound) {
                        wordGame.guessedLetters.push(buttonVal);
                        wordGame.currentLetterGuessed = buttonVal;
                        $("#guessedLetters").val(wordGame.guessedLetters);
                        wordGame.searchWord();
                    }
                } else {
                    i++;
                }
            }
        }
    });
});
